# E2E Test: Create Group and Add Expense Flow
# Tests the happy path: Create group -> Add members -> Add expense -> View balances
#
# Run with: maestro test .maestro/create-group-expense.yaml

appId: host.exp.Exponent

---

# Step 1: Open app and navigate to home screen
- runFlow: flows/open-app.yaml

# Step 2: Create a new group
# Try "Create Your First Group" (empty state) or "+" FAB (has groups)
- tapOn:
    text: "Create.*Group"
    optional: true

- tapOn:
    text: "\\+"
    optional: true

# Verify we're on create group screen
- assertVisible: "Group Name"

# Enter group name - tap on the placeholder text
- tapOn:
    text: "e.g., Vacation 2025, Roommates"
- eraseText: 50
- inputText: "Dinner Party Test"
- pressKey: Enter

- pressKey: Enter

# Select an emoji icon (tap first one in grid - money bag)
- tapOn: "ðŸ’°"

# Tap create button
- tapOn: "Create Group"

# Step 3: Verify group was created and we're on group detail
- extendedWaitUntil:
    visible: "Dinner Party Test"
    timeout: 10000

# Dismiss any error overlays that might appear (may need multiple dismissals)
- tapOn:
    text: "Dismiss"
    optional: true

- extendedWaitUntil:
    visible: ".*"
    timeout: 3000

- tapOn:
    text: "Dismiss"
    optional: true

- extendedWaitUntil:
    visible: ".*"
    timeout: 3000

- tapOn:
    text: "Dismiss"
    optional: true

# Wait for group detail to be visible
- extendedWaitUntil:
    visible: "Members"
    timeout: 15000

# Step 4: Add first member - tap the Add button using testID
- tapOn:
    id: "add-member-button"

# Wait for add member screen to load
- extendedWaitUntil:
    visible: "Name"
    timeout: 5000

# Enter member name using testID
- tapOn:
    id: "member-name-input"
- eraseText: 50
- inputText: "Alice"
- pressKey: Enter

- pressKey: Enter

# Wait a moment
- extendedWaitUntil:
    visible: "Add Member"
    timeout: 3000

# Tap add button using testID
- tapOn:
    id: "submit-add-member"

# Wait for navigation back to group
- extendedWaitUntil:
    visible: "Dinner Party Test"
    timeout: 10000

# Verify member added
- assertVisible: "Alice"

# Step 5: Add second member
- tapOn:
    id: "add-member-button"

- extendedWaitUntil:
    visible: "Name"
    timeout: 5000

- tapOn:
    id: "member-name-input"
- eraseText: 50
- inputText: "Bob"
- pressKey: Enter

- pressKey: Enter

- extendedWaitUntil:
    visible: "Add Member"
    timeout: 3000

- tapOn:
    id: "submit-add-member"

- extendedWaitUntil:
    visible: "Dinner Party Test"
    timeout: 10000

- assertVisible: "Bob"

# Step 6: Add third member
- tapOn:
    id: "add-member-button"

- extendedWaitUntil:
    visible: "Name"
    timeout: 5000

- tapOn:
    id: "member-name-input"
- eraseText: 50
- inputText: "Charlie"
- pressKey: Enter

- pressKey: Enter

- extendedWaitUntil:
    visible: "Add Member"
    timeout: 3000

- tapOn:
    id: "submit-add-member"

- extendedWaitUntil:
    visible: "Dinner Party Test"
    timeout: 10000

- assertVisible: "Charlie"

# Step 7: Add an expense - tap the FAB or Add Expense button
- tapOn:
    text: ".*Add Expense"

# Wait for add expense screen
- extendedWaitUntil:
    visible: "What's it for?"
    timeout: 5000

# Enter expense description using testID
- tapOn:
    id: "expense-description-input"
- eraseText: 50
- inputText: "Pizza and drinks"
- pressKey: Enter

- pressKey: Enter

# Wait for keyboard to dismiss
- extendedWaitUntil:
    visible: "Paid by"
    timeout: 3000

# Enter amount - tap on the amount display
- tapOn:
    text: "0.00"
- eraseText: 10
- inputText: "75.00"
- pressKey: Enter

- pressKey: Enter

# Wait for keyboard to dismiss
- extendedWaitUntil:
    visible: "Split between"
    timeout: 3000

# Select Alice as payer (first member shown)
- tapOn: "Alice"

# Scroll down to see submit button
- scroll

# Wait and save expense
- extendedWaitUntil:
    visible: "Add Expense"
    timeout: 2000

- tapOn:
    id: "submit-add-expense"

# Step 8: Verify expense was added
- extendedWaitUntil:
    visible: "Pizza and drinks"
    timeout: 10000

# Step 9: Check balances
- tapOn: "View Balances"

# Verify balance screen
- assertVisible: "Balances"
- assertVisible: "Individual Balances"

# Alice paid $75 for 3 people = $25 each
# Verify Alice shows up with "is owed"
- assertVisible: "Alice"
- assertVisible: "is owed"

# Step 10: Verify settlement section
- assertVisible: "Settle Up"

# Success - full flow completed
