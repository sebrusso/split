# E2E Test: Settlement/Payment Flow
# Tests: View balances -> Select settlement -> Record payment
#
# Run with: maestro test .maestro/settlement-flow.yaml

appId: host.exp.Exponent

---

# Step 1: Open app and navigate to home screen
- runFlow: flows/open-app.yaml

# Step 2: Navigate to a group with existing balances (tap first group)
- tapOn:
    text: ".*"
    index: 1

# Wait for group detail screen
- extendedWaitUntil:
    visible: "Members"
    timeout: 10000

# Step 3: Go to balances screen
- tapOn: "View Balances"

# Step 4: Verify balance information is shown
- assertVisible: "Balances"
- assertVisible: "Individual Balances"

# Step 5: Look for outstanding balances
- runFlow:
    when:
      visible: "is owed"
    commands:
      - assertVisible: "Settle Up"

# Step 6: Tap on Settle button for a member who owes money
- tapOn:
    text: "Settle"
    optional: true

# Step 7: If settlement modal appears, verify it
- runFlow:
    when:
      visible: "Record Settlement"
    commands:
      - assertVisible: "Payment Method"
      - assertVisible: "Date"
      # Tap Confirm to record the settlement
      - tapOn: "Confirm"

# Step 8: Verify Quick Pay options are available (if shown)
- runFlow:
    when:
      visible: "Quick Pay With"
    commands:
      - assertVisible: "Venmo"

# Step 9: Check settlement history section
- runFlow:
    when:
      visible: "Settlement History"
    commands:
      - assertVisible: "Settlement History"

# Step 10: Verify all settled case
- runFlow:
    when:
      visible: "All settled up"
    commands:
      - assertVisible: "All settled up"

# Success - settlement flow completed
