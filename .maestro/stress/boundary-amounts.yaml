# Stress Test: Boundary Amount Edge Cases
# Goal: Test edge case amounts that break split calculations
#
# Breaking scenarios:
# - Division by 3 creates infinite decimal
# - Last-person rounding adjustment goes negative
# - Large numbers overflow display or calculations
#
# Run with: maestro test .maestro/stress/boundary-amounts.yaml

appId: com.splitfree.app

---

# Step 1: Launch app
- launchApp

- assertVisible: "SplitFree"

# Step 2: Create a test group
- tapOn: "Create Group"

- tapOn:
    id: "group-name-input"
- inputText: "Boundary Amount Test"

- tapOn: "Create"

- extendedWaitUntil:
    visible: "Boundary Amount Test"
    timeout: 10000

# Step 3: Add exactly 3 members (worst case for division)
- tapOn: "Add Member"
- tapOn:
    id: "member-name-input"
- inputText: "Alice"
- tapOn: "Add"

- tapOn: "Add Member"
- tapOn:
    id: "member-name-input"
- inputText: "Bob"
- tapOn: "Add"

- tapOn: "Add Member"
- tapOn:
    id: "member-name-input"
- inputText: "Charlie"
- tapOn: "Add"

# Verify 3 members
- assertVisible: "Alice"
- assertVisible: "Bob"
- assertVisible: "Charlie"

# ========================================
# TEST 1: $0.01 split 3 ways
# ========================================

- tapOn: "Add Expense"

- tapOn:
    id: "expense-description-input"
- inputText: "One Cent Test"

- tapOn:
    id: "expense-amount-input"
- inputText: "0.01"

- tapOn: "Who paid?"
- tapOn: "Alice"

- tapOn: "Save"

- extendedWaitUntil:
    visible: "One Cent Test"
    timeout: 10000

# Check balances for negative amounts
- tapOn: "Balances"

# CRITICAL: No negative amounts should appear
- assertNotVisible: "-$0.01"
- assertNotVisible: "-$0.02"

- tapOn:
    text: "Back"
    optional: true

# ========================================
# TEST 2: $0.02 split 3 ways
# ========================================

- tapOn: "Add Expense"

- tapOn:
    id: "expense-description-input"
- inputText: "Two Cents Test"

- tapOn:
    id: "expense-amount-input"
- inputText: "0.02"

- tapOn: "Who paid?"
- tapOn: "Alice"

- tapOn: "Save"

- extendedWaitUntil:
    visible: "Two Cents Test"
    timeout: 10000

# ========================================
# TEST 3: $1.00 split 3 ways (classic problem)
# ========================================

- tapOn: "Add Expense"

- tapOn:
    id: "expense-description-input"
- inputText: "One Dollar Test"

- tapOn:
    id: "expense-amount-input"
- inputText: "1.00"

- tapOn: "Who paid?"
- tapOn: "Charlie"

- tapOn: "Save"

- extendedWaitUntil:
    visible: "One Dollar Test"
    timeout: 10000

# ========================================
# TEST 4: Large amount - $999,999.99
# ========================================

- tapOn: "Add Expense"

- tapOn:
    id: "expense-description-input"
- inputText: "Maximum Amount Test"

- tapOn:
    id: "expense-amount-input"
- inputText: "999999.99"

- tapOn: "Who paid?"
- tapOn: "Alice"

- tapOn: "Save"

- extendedWaitUntil:
    visible: "Maximum Amount Test"
    timeout: 15000

# Verify large amount displays without overflow
- assertVisible: "999"

# ========================================
# FINAL VERIFICATION
# ========================================

# Navigate to balances
- tapOn: "Balances"

- extendedWaitUntil:
    visible: "Who Owes Who"
    timeout: 10000

# CRITICAL: No NaN or undefined
- assertNotVisible: "NaN"
- assertNotVisible: "undefined"
- assertNotVisible: "Infinity"
