# Stress Test: Rapid Navigation
# Goal: Fast screen switching to expose state leaks and memory issues
#
# Breaking scenarios:
# - useFocusEffect races with previous fetches
# - In-flight requests return to wrong screen context
# - Memory leaks from uncancelled subscriptions
#
# Run with: maestro test .maestro/stress/rapid-navigation.yaml

appId: host.exp.Exponent

---

# Step 1: Launch app
- launchApp

- assertVisible: "split it."

# ========================================
# RAPID GROUP SWITCHING
# Navigate between groups faster than data can load
# ========================================

# Tap first group
- tapOn:
    index: 0

# IMMEDIATELY navigate back (before load completes)
- swipe:
    direction: RIGHT
    duration: 100

# Tap first group again
- tapOn:
    index: 0

# Back again
- swipe:
    direction: RIGHT
    duration: 100

# Tap again
- tapOn:
    index: 0

# ========================================
# RAPID MODAL OPENING/CLOSING
# ========================================

# Wait for group to load
- extendedWaitUntil:
    visible: "Add Expense"
    timeout: 5000

# Open modal and immediately close 5 times
- repeat:
    times: 5
    commands:
      - tapOn:
          text: "Add Expense"
          optional: true
      - swipe:
          direction: DOWN
          duration: 100

# ========================================
# RAPID TAB SWITCHING
# ========================================

- tapOn:
    text: "Balances"
    optional: true

- tapOn:
    text: "Expenses"
    optional: true

- tapOn:
    text: "Balances"
    optional: true

- tapOn:
    text: "Expenses"
    optional: true

# Rapid switching 10 times
- repeat:
    times: 10
    commands:
      - tapOn:
          text: "Balances"
          optional: true
      - tapOn:
          text: "Expenses"
          optional: true

# ========================================
# FINAL STABILITY CHECK
# ========================================

# Wait for any pending operations
- extendedWaitUntil:
    visible: "Expenses"
    timeout: 5000

# App should not be crashed
- assertVisible: "Expenses"

# No error dialogs
- assertNotVisible: "Error"
- assertNotVisible: "crash"
- assertNotVisible: "undefined"

# Navigate home to verify app still functional
- swipe:
    direction: RIGHT
    duration: 200

# Final assertion - home screen loads
- assertVisible: "split it."
